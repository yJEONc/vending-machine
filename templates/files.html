<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>{{ folder }} 폴더의 PDF 목록</title>
  <style>
    .order-label {
      color: blue;
      font-weight: bold;
      margin-left: 8px;
    }
  </style>
  <script>
    let selectedOrder = [];

    function toggleFile(checkbox, labelId) {
      const file = checkbox.value;
      const label = document.getElementById(labelId);

      if (checkbox.checked) {
        selectedOrder.push(file);
      } else {
        selectedOrder = selectedOrder.filter(f => f !== file);
      }
      updateHiddenInputs();
      updateLabels();
    }

    function updateHiddenInputs() {
      const container = document.getElementById('selected-container');
      container.innerHTML = '';
      selectedOrder.forEach(f => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'files[]';
        input.value = f;
        container.appendChild(input);
      });
    }

    // ✅ 클릭 순서 시각적으로 표시
    function updateLabels() {
      document.querySelectorAll('.order-label').forEach(l => l.textContent = '');
      selectedOrder.forEach((f, i) => {
        const label = document.getElementById('label-' + f.replace(/[^a-zA-Z0-9]/g, ''));
        if (label) label.textContent = '(' + (i + 1) + ')';
      });
    }
  </script>
</head>
<body>
  <h2>{{ folder }} 폴더의 PDF 목록</h2>
  <form method="POST" action="/merge">
    <input type="hidden" name="folder" value="{{ folder }}">
    <div id="selected-container"></div>

    {% for file in pdf_files %}
      {% set clean_id = file|replace(' ', '')|replace('[', '')|replace(']', '')|replace('(', '')|replace(')', '')|replace('.', '')|replace('-', '') %}
      <input type="checkbox" value="{{ file }}" onclick="toggleFile(this, 'label-{{ clean_id }}')"> {{ file }}
      <span class="order-label" id="label-{{ clean_id }}"></span><br>
    {% endfor %}

    <br>
    <label>출력 파일명: </label>
    <input type="text" id="filename" name="output_filename" value="merged">
    <button type="submit">합치기</button>
  </form>

  <br>
  <a href="/">← 폴더 목록으로 돌아가기</a>
</body>
</html>
