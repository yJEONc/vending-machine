<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>{{ folder }} 폴더의 PDF 목록</title>
  <style>
    .order-label {
      color: blue;
      font-weight: bold;
      margin-left: 8px;
    }
  </style>
  <script>
    let selectedOrder = [];

    function toggleFile(checkbox, idx, file) {
      if (checkbox.checked) {
        selectedOrder.push({idx: idx, file: file});
      } else {
        selectedOrder = selectedOrder.filter(f => f.file !== file);
      }
      updateHiddenInputs();
      updateLabels();
    }

    function updateHiddenInputs() {
      const container = document.getElementById('selected-container');
      container.innerHTML = '';
      selectedOrder.forEach(f => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'files[]';
        input.value = f.file;
        container.appendChild(input);
      });
    }

    function updateLabels() {
      document.querySelectorAll('.order-label').forEach(l => l.textContent = '');
      selectedOrder.forEach((f, i) => {
        const label = document.getElementById('label-' + f.idx);
        if (label) label.textContent = '(' + (i + 1) + ')';
      });
    }
  </script>
</head>
<body>
  <h2>{{ folder }} 폴더의 PDF 목록</h2>
  <form method="POST" action="/merge">
    <input type="hidden" name="folder" value="{{ folder }}">
    <div id="selected-container"></div>

    {% for file in pdf_files %}
      <input type="checkbox" value="{{ file }}" onclick="toggleFile(this, {{ loop.index0 }}, '{{ file }}')">
      {{ file }} <span class="order-label" id="label-{{ loop.index0 }}"></span><br>
    {% endfor %}

    <br>
    <label>출력 파일명: </label>
    <input type="text" id="filename" name="output_filename" value="merged">
    <button type="submit">합치기</button>
  </form>

  <br>
  <a href="/">← 폴더 목록으로 돌아가기</a>
</body>
</html>
